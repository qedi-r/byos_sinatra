<%= @form.input :name, label: "Schedule name", required: true %>
<%= @form.input :default_plugin, label: "Default plugin", required: true%>

</div>
<%= erb :"shared/heading", locals: { title: "Schedule Events" } %>
<div id="schedule-events" class="flex flex-col overflow-hidden rounded-xl border border-gray-300 bg-gray-50">
    <% if @schedule.schedule_events.length > 0 %>
    <div class="flex border-b grow flex-col items-left justify-between px-5 py-5">
        <h3 class="font-medium text-gray-900 text-lg md:text-xl mb-0.5 leading-none">
            Existing events
        </h3>
    </div>
        <% @schedule.schedule_events.each do |se| %>
    <div id="schedule_events_display[<%= se.id %>]"
        class="flex border-b grow flex-row items-left justify-between px-5 py-5">
        <div class="grow">
            <h3 class="text-gray-900 text-lg">Event</h3>
            <div class="schedule-event">
                <input type="hidden" 
                    id="schedule_events[<%= se.id %>][start_time]" 
                    name="schedule_events[<%= se.id %>][start_time]" 
                    value="<%= se.start_time %>">
                <input type="hidden" 
                    id="schedule_events[<%= se.id %>][end_time]" 
                    name="schedule_events[<%= se.id %>][end_time]" 
                    value="<%= se.end_time %>">
                <input type="hidden" 
                    id="schedule_events[<%= se.id %>][interruptible]" 
                    name="schedule_events[<%= se.id %>][interruptible]" 
                    value="<%= se.interruptible %>">
                <input type="hidden" 
                    id="schedule_events[<%= se.id %>][plugins]" 
                    name="schedule_events[<%= se.id %>][plugins]" 
                    value="<%= se.plugins %>">
                <input type="hidden" 
                    id="schedule_events[<%= se.id %>][update_frequency]" 
                    name="schedule_events[<%= se.id %>][update_frequency]" 
                    value="<%= se.update_frequency %>">
                Time: <%= se.format_date(se.start_time) %> - <%= se.format_date(se.end_time) %><br/>
                <% if se.interruptible %>
                    Interrupible<br/>
                <% end %>
                Plugins: <%= se.plugins %><br/>
                Update Frequency: <%= se.update_frequency %>
            </div>
        </div>
        <div class="">
            <%= @form.input(:button, {obj: nil, value: 'Delete', attr: {
                    onclick: 'removeEvent(' + se.id.to_s + ')'}
                }
            ) %>
        </div>
    </div>
        <% end %>
    <% end %>
    <div class="flex border-b grow flex-col justify-between px-5 py-5">
        <h3 class="font-medium text-gray-900 text-lg md:text-xl mb-0.5 leading-none">
            Add a new event
        </h3>
    </div>
    <div class="flex border-b grow flex-col justify-between px-5 py-5">
        <div class="schedule-event">
            <%= sf = @form.subform(:schedule_events, nil, { id: "-1" }) %>
            <%= sf.input(:start_time, label: "Start Time:", type: :time) %>
            <%= sf.input(:end_time, label: "End Time:", type: :time) %>
            <%= sf.input(:interruptible, label: "Interruptible:", type: :checkbox) %>
            <%= sf.input(:plugins, label: "Plugins:", type: :text) %>
            <%= sf.input(:update_frequency, label: "Update Frequency:", type: :number) %>
        </div>
    </div>
    <%= @form.input(:button, {obj: nil, value: 'Add another event', attr: {
            onclick: 'addEvent()'}
        }
    ) %>
    <script>
        IDS=["start_time", "end_time", "interruptible", "plugins", "update_frequency"];
        function removeEvent(id) {
            debugger;
            displayElem = document.getElementById(`schedule_events_display[${id}]`);
            if (displayElem) {
                IDS.forEach(fieldName => {
                    elem = document.getElementById(`schedule_events[${id}][${fieldName}]`);
                    elem && elem.remove();
                });
                fetch(`/scheduleEvent/${id}/delete`).then(() => {
                    displayElem.remove();
                })
            }
        }
        function addEvent() {

        }
    </script>
</div>

<div>
<%= @form.button 'Create Schedule' %>